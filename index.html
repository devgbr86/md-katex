<!DOCTYPE html>
<html lang="pt-BR">

<head>
     <meta charset="UTF-8">
     <title>Editor Online [MD+KaTeX]</title>

     <!-- Libs -->
     <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
     <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

     <style>
          body {
               font-family: sans-serif;
               background: #f5f5f5;
               padding: 1rem;
               display: flex;
               flex-direction: column;
               align-items: center;
               height: 100vh;
          }

          h1 {
               font-size: 1.2rem;
               margin-bottom: 0.5rem;
          }

          textarea {
               width: 90%;
               height: 80vh;
               padding: 1rem;
               border: 1px solid #ccc;
               border-radius: 6px;
               resize: none;
               font-family: monospace;
               font-size: 1rem;
               background: white;
          }

          button {
               margin-top: 1rem;
               padding: 0.7rem 1.4rem;
               background: #0078d7;
               color: white;
               border: none;
               border-radius: 4px;
               cursor: pointer;
          }

          button:hover {
               background: #005fa3;
          }

          footer {
               margin-top: 1rem;
               font-size: 0.9rem;
               color: #555;
               text-align: center;
          }

          footer a {
               color: #0078d7;
               text-decoration: none;
          }

          footer a:hover {
               text-decoration: underline;
          }
     </style>
</head>

<body>
     <h1>Editor Online [MD+KaTeX]</h1>
     <textarea id="editor" placeholder="Digite aqui seu texto em Markdown + KaTeX ($$a^2+b^2=c^2$$)..."></textarea>
     <button id="exportPdf">Exportar PDF</button>

     <footer>
          <p>
               Projeto editor online que combina <strong>Markedjs</strong> e <strong>KaTeXjs</strong> para
               editar documentos, fórmulas matemáticas e exportar em formato PDF.<br>
               — <a href="https://github.com/devgbr86" target="_blank">github.com/devgbr86</a>
          </p>
     </footer>

     <script>
          const editor = document.getElementById("editor");
          const exportBtn = document.getElementById("exportPdf");

          exportBtn.addEventListener("click", () => {
               const markdown = editor.value;

               // Converte Markdown para HTML
               const html = marked.parse(markdown);

               // Cria um contêiner temporário para renderizar KaTeX
               const tempDiv = document.createElement("div");
               tempDiv.innerHTML = html;

               // Renderiza KaTeX nas expressões matemáticas
               renderMathInElement(tempDiv, {
                    delimiters: [
                         { left: "$$", right: "$$", display: true },
                         { left: "$", right: "$", display: false }
                    ]
               });

               // Gera o PDF a partir do conteúdo renderizado
               const opt = {
                    margin: 0.5,
                    filename: "documento.pdf",
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: "in", format: "a4", orientation: "portrait" }
               };
               html2pdf().from(tempDiv).set(opt).save();
          });
     </script>
</body>

</html>